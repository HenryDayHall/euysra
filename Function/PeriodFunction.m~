%This function takes in the true anomaly and some parameters of the system
%and outputs the time (in some units) at that true anomaly
%Going to be usefull for calculating the change in mass
function [t] = PeriodFunction (G,a,e,Mp,Ms,semiAxis,k,f)

%ABBANDON SHIP -> we are now using a diffrent calculation-------
%The calulation is found on pg588 of theory of orbits
% it has been split into smaller terms
%term1 = (k*sqrt(Mp + Ms))./((semiAxis^(3/2))*(1-e^2)^(3/2));
%term2 = (e*sin(f))./((e^2 - 1)*(e*cos(f) + 1));
%term3top = 2*atanh(((e - 1).*tan(f/2))./sqrt(e^2 - 1));
%term3bottom = (e^2 - 1)^(3/2);
%term3 = term3top./term3bottom;
%t = (1/term1)*(term2 - term3);
%calculation of df/dt for comparison
%diff = term1*(1 + e*cos(f)).^2;
%attempt N.O. 2 starts here
%f is ALWAYS positive.

%This calculates the time values for each f between -pi/2 & pi/2.
%We're calling this the start seg
function tInStartSeg = timeSegment(G,e,Mp,Ms,semiAxis,k,f)
eccAnomaly = atan(sqrt(1-e^2)*sin(f))/(e+cos(f));
meanAnomaly = eccAnomaly -e*sin(eccAnomaly);
tInStartSeg = sqrt(semiAxis^3/(G*(Mp + Ms)))*meanAnomaly;
end
%The number of segments that have been passed post start seg segment
segmentNumber=floor(f/pi + 1/2);
%The time height of the start seg
tStop  = timeSegment(pi/2);
%The angle of f, shifted back to the start segment
fInStartSeg = f-(pi + segmentNumber*pi);
%total time passed after number of angles crossed
t = timeSegment(G,e,Mp,Ms,semiAxis,k,fInStartSeg) + tStop*2*segmentNumber;
%Here we label the axis and plot
hold on
xlabel('True anomaly in rads')
ylabel('Time in seconds')
plot(f,t);
%plot(f,diff);

%for comparison
%plot(f,40*sin(f));

